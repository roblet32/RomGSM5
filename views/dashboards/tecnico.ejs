<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard T√©cnico | ROCKETGSM</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <style>
    .dashboard-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 32px 24px;
      border-radius: var(--border-radius);
      margin-bottom: 32px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.1);
    }
    
    .dashboard-title {
      font-size: 28px;
      font-weight: 700;
      margin: 0 0 8px 0;
    }
    
    .dashboard-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin: 0;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .stat-card {
      background: #fff;
      border-radius: var(--border-radius);
      padding: 24px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.07);
      border: 1px solid #e2e8f0;
      text-align: center;
      transition: all var(--transition);
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }
    
    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--text);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .section-card {
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 24px rgba(0,0,0,0.07);
      border: 1px solid #e2e8f0;
      margin-bottom: 32px;
      overflow: hidden;
    }
    
    .section-header {
      background: var(--background);
      padding: 20px 24px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary-dark);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-content {
      padding: 24px;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    .table-container table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table-container th,
    .table-container td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .table-container th {
      background: var(--background);
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .table-container tr:hover {
      background: var(--background);
    }
    
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .status-pendiente { 
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: white; 
    }
    
    .status-asignada { 
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white; 
    }
    
    .status-cotizacion_enviada { 
      background: linear-gradient(135deg, var(--secondary), #8e44ad);
      color: white; 
    }
    
    .status-aprobada { 
      background: linear-gradient(135deg, var(--success), #2ecc71);
      color: white; 
    }
    
    .status-en_proceso { 
      background: linear-gradient(135deg, #e67e22, #d35400);
      color: white; 
    }
    
    .status-finalizada { 
      background: linear-gradient(135deg, var(--success), #2ecc71);
      color: white; 
    }
    
    .status-cancelada { 
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: white; 
    }
    
    .priority-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .priority-alta {
      background: linear-gradient(135deg, var(--danger), #c0392b);
      color: white;
    }
    
    .priority-media {
      background: linear-gradient(135deg, #f39c12, #e67e22);
      color: white;
    }
    
    .priority-baja {
      background: linear-gradient(135deg, var(--success), #2ecc71);
      color: white;
    }
    
    .btn-action {
      padding: 8px 16px;
      border-radius: var(--border-radius);
      text-decoration: none;
      display: inline-block;
      transition: all var(--transition);
      font-weight: 500;
      font-size: 14px;
      margin: 2px;
    }
    
    .btn-take {
      background: linear-gradient(135deg, var(--success), #2ecc71);
      color: white;
      border: none;
      cursor: pointer;
    }
    
    .btn-view {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }
    
    .btn-action:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 24px;
      color: var(--text);
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 16px;
      margin: 0;
      color: var(--text);
    }
    
    .client-name {
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .device-info {
      font-size: 14px;
      color: var(--text);
      line-height: 1.4;
    }
    
    .service-type {
      font-weight: 500;
      color: var(--text);
    }
    
    .actions-cell {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
      
      .stat-card {
        padding: 20px;
      }
      
      .stat-number {
        font-size: 24px;
      }
      
      .table-container {
        font-size: 14px;
      }
      
      .table-container th,
      .table-container td {
        padding: 12px 8px;
      }
      
      .actions-cell {
        flex-direction: column;
        gap: 4px;
      }
      
      .btn-action {
        font-size: 12px;
        padding: 6px 12px;
      }
    }
    
    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .dashboard-header {
        padding: 24px 16px;
      }
      
      .dashboard-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <main>
    <div class="container">
      <!-- Header del Dashboard -->
      <div class="dashboard-header">
        <h1 class="dashboard-title">üë®‚Äçüîß Dashboard T√©cnico</h1>
        <p class="dashboard-subtitle">Bienvenido, <%= user && user.nombreDisplay ? user.nombreDisplay : 'T√©cnico' %></p>
      </div>

      <!-- Estad√≠sticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-number"><%= ordenesDisponibles.length %></div>
          <div class="stat-label">√ìrdenes Disponibles</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üõ†Ô∏è</div>
          <div class="stat-number"><%= misOrdenes.length %></div>
          <div class="stat-label">Mis √ìrdenes</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚è≥</div>
          <div class="stat-number"><%= misOrdenes.filter(o => o.estado === 'asignada' || o.estado === 'en_proceso').length %></div>
          <div class="stat-label">En Proceso</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-number"><%= misOrdenes.filter(o => o.estado === 'finalizada').length %></div>
          <div class="stat-label">Completadas</div>
        </div>
      </div>

      <!-- √ìrdenes Disponibles -->
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">üìã √ìrdenes Disponibles</h2>
        </div>
        <div class="section-content">
          <% if (ordenesDisponibles.length === 0) { %>
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <p class="empty-state-text">No hay √≥rdenes disponibles en este momento.</p>
            </div>
          <% } else { %>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>Dispositivo</th>
                    <th>Tipo Servicio</th>
                    <th>Prioridad</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <% ordenesDisponibles.forEach(function(o) { %>
                    <tr>
                      <td>
                        <div class="client-name">
                          <%= o && o.dispositivo && o.dispositivo.cliente ? o.dispositivo.cliente.nombre : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <div class="device-info">
                          <%= o && o.dispositivo && o.dispositivo.descripcionCompleta ? o.dispositivo.descripcionCompleta : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <div class="service-type">
                          <%= o && o.tipoServicio ? o.tipoServicio : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <span class="priority-badge priority-<%= o && o.prioridad ? o.prioridad.toLowerCase() : 'media' %>">
                          <%= o && o.prioridad ? o.prioridad : 'Media' %>
                        </span>
                      </td>
                      <td class="actions-cell">
                        <form action="/tecnico/ordenes/<%= o._id %>/tomar" method="POST" style="display:inline;">
                          <button type="submit" class="btn-action btn-take">üìã Tomar Orden</button>
                        </form>
                        <a href="/tecnico/ordenes/<%= o._id %>" class="btn-action btn-view">üëÅÔ∏è Ver Detalle</a>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Mis √ìrdenes -->
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">üõ†Ô∏è Mis √ìrdenes</h2>
        </div>
        <div class="section-content">
          <% if (misOrdenes.length === 0) { %>
            <div class="empty-state">
              <div class="empty-state-icon">üì≠</div>
              <p class="empty-state-text">No tienes √≥rdenes asignadas en este momento.</p>
            </div>
          <% } else { %>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Cliente</th>
                    <th>Dispositivo</th>
                    <th>Tipo Servicio</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <% misOrdenes.forEach(function(o) { %>
                    <tr>
                      <td>
                        <div class="client-name">
                          <%= o && o.dispositivo && o.dispositivo.cliente ? o.dispositivo.cliente.nombre : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <div class="device-info">
                          <%= o && o.dispositivo && o.dispositivo.descripcionCompleta ? o.dispositivo.descripcionCompleta : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <div class="service-type">
                          <%= o && o.tipoServicio ? o.tipoServicio : 'N/A' %>
                        </div>
                      </td>
                      <td>
                        <span class="status-badge status-<%= o && o.estado ? o.estado : 'pendiente' %>">
                          <%= o && o.estado ? o.estado.replace('_', ' ') : 'N/A' %>
                        </span>
                      </td>
                      <td class="actions-cell">
                        <a href="/tecnico/ordenes/<%= o._id %>" class="btn-action btn-view">üëÅÔ∏è Ver Detalle</a>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Acciones R√°pidas -->
      <div class="section-card">
        <div class="section-header">
          <h2 class="section-title">‚ö° Acciones R√°pidas</h2>
        </div>
        <div class="section-content">
          <div style="display: flex; gap: 16px; flex-wrap: wrap;">
            <a href="/tecnico/mis-ordenes" class="btn-action btn-view">üìã Mis √ìrdenes</a>
            <a href="/logout" class="btn-action btn-take">üö™ Cerrar Sesi√≥n</a>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <%- include('../partials/footer') %>
</body>
</html>